‚Äî –ü–µ—Ä–µ–π—Ç–∏ –≤ [[HUB]] ‚Äî
> [!INFO] –ß—Ç–æ —Ç–∞–∫–æ–µ **Ansible**?
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏, —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---
### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤—ã

> [!tldr] **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã**
> 
> - `ansible` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç
> - `sshpass` ‚Äî –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ –ø–∞—Ä–æ–ª—é –≤ SSH (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –∏ —Ñ–∞–π–ª—ã

> [!info] **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤**
> 
> - `/etc/ansible/` ‚Äî –≥–ª–∞–≤–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥
> - `ansible.cfg` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
> - `hosts` ‚Äî —Ñ–∞–π–ª —Å –≥—Ä—É–ø–ø–∞–º–∏/–æ–±—ä–µ–∫—Ç–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
> - `group_vars/` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥—Ä—É–ø–ø —Ö–æ—Å—Ç–æ–≤
> - `host_vars/` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤
> - `group_vars/all.yml` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤

Ansible –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SSH –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö. –í–∞–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–ø–æ—Å–æ–± –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ø–∞—Ä–æ–ª—å –∏–ª–∏ –∫–ª—é—á SSH).

---

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
ansible <group | object> -m <module> -a <arguments>

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ö–æ—Å—Ç–æ–≤
ansible all -m ping

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ —É–¥–∞–ª—ë–Ω–Ω–æ–π –æ–±–æ–ª–æ—á–∫–µ
ansible all -m shell -a 'uptime'

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
ansible all -m copy -a 'src=/local/path dest=/remote/path'

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ
ansible all -m setup -a 'filter=ansible_distribution'

# –ó–∞–ø—É—Å–∫ playbook
ansible-playbook playbook.yml -i inventory.yml
```

---

### –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (inventory)

> [!tip] **–§–∞–π–ª hosts** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Ansible –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/etc/ansible/hosts`, –Ω–æ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –¥—Ä—É–≥–æ–π, —É–∫–∞–∑–∞–≤ `-i` –≤ –∫–æ–º–∞–Ω–¥–µ.

#### **–ü—Ä–∏–º–µ—Ä inventory.yml**

```yaml
all:
  children:
    webservers:
      hosts:
        web1:
          ansible_host: 192.168.33.11
          ansible_user: root
        web2:
          ansible_host: 192.168.33.12
          ansible_user: root
```

#### **–ü—Ä–∏–º–µ—Ä inventory.ini**

```ini
[webservers]
web1 ansible_host=192.168.33.11 ansible_user=root
web2 ansible_host=192.168.33.12 ansible_user=root
```

---

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø –∏ —Ö–æ—Å—Ç–æ–≤

> [!example] **–ü—Ä–∏–º–µ—Ä `group_vars/all.yml`**

```yaml
ansible_user: admin
ansible_python_interpreter: /usr/bin/python3

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –ø–∞—Ä–æ–ª—é
ansible_ssh_user: user
ansible_ssh_pass: password

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª—é—á—É
ansible_ssh_private_key_file: /home/user/.ssh/id_rsa
```

---

### Playbook (—Å—Ü–µ–Ω–∞—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏)

> [!quote] **Playbook** ‚Äî —ç—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.

#### **–ü—Ä–æ—Å—Ç–µ–π—à–∏–π playbook**

```yaml
---
- name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
  hosts: webservers
  become: yes  # –ó–∞–ø—É—Å–∫ –æ—Ç –∏–º–µ–Ω–∏ root
  tasks:
    - name: –û–±–Ω–æ–≤–∏—Ç—å –∫–µ—à –ø–∞–∫–µ—Ç–æ–≤
      apt:
        update_cache: yes

    - name: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Nginx
      apt:
        name: nginx
        state: present
```

#### **–ó–∞–ø—É—Å–∫**

```bash
ansible-playbook install_nginx.yml
```

---

### Jinja2 (–®–∞–±–ª–æ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π)

> [!note] **Jinja2** ‚Äî —à–∞–±–ª–æ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ª–æ–≥–∏–∫—É –≤ —Ñ–∞–π–ª–∞—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

#### **–ü—Ä–∏–º–µ—Ä —à–∞–±–ª–æ–Ω–∞** `nginx.conf.j2`

```jinja2
server {
    listen 80;
    server_name {{ ansible_fqdn }};
    location / {
        proxy_pass http://localhost:8080;
    }
}
```

#### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ playbook**

```yaml
- name: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/sites-available/default
```

---

### üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- üìñ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Ansible](https://docs.ansible.com/)
- üì∞ [–û–±—É—á–µ–Ω–∏–µ –Ω–∞ Habr](https://habr.com/ru/articles/305400/)
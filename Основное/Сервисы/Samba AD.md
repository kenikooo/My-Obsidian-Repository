‚Äî –ü–µ—Ä–µ–π—Ç–∏ –≤ [[HUB]] ‚Äî
> [!INFO] –ß—Ç–æ —Ç–∞–∫–æ–µ **Samba AD**?
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–∞–∫ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ–º–µ–Ω–∞ Active Directory

–£—Å—Ç–∞–Ω–æ–≤–∏–º –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤:
```bash
apt-get update && apt-get install task-samba-dc
```
–û—Å—Ç–∞–Ω–æ–≤–∏–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Å–ª—É–∂–±—ã:
```bash
for service in smb nmb krb5kdc slapd bind; do
	systemctl disable $service;
	systemctl stop $service;
done
```
–û—á–∏—Å—Ç–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
rm -f /etc/samba/smb.conf
rm -rf /var/lib/samba
rm -rf /var/cache/samba
mkdir /var/lib/samba/sysvol
```
–ü–µ—Ä–µ–π–¥–µ–º –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é —Ä–∞–∑–≤–µ—Ä—Ç–∫—É –¥–æ–º–µ–Ω–∞:
```bash
samba-tool domain provision
# –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
```
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–∑–≤–µ—Ä—Ç–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—É:
```bash
systemctl start samba
reboot
# –ö–æ–≥–¥–∞ –û–° –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è:
systemctl status samba # –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–Ω—è–ª—Å—è - systemctl enable --now samba, –æ—à–∏–±–æ–∫ –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ
```
–¢–µ–ø–µ—Ä—å –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –±–∏–ª–µ—Ç Kerberos:
```bash
kinit administrator
# –≤–≤–æ–¥–∏–º –∑–∞–¥–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
```

–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –¥–æ–º–µ–Ω—É:
```bash
apt-get update && apt-get install task-auth-ad-sssd

system-auth write ad horns.hooves cli horns 'administrator' 'P@ssw0rd'
```

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–æ–≤—ã–º–∏ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏, —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
apt-get update && apt-get install admc -y
```
–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
- üìñ [–ê–ª—å—Ç –î–æ–º–µ–Ω](https://docs.altlinux.org/ru-RU/alt-server/11.1/html/alt-server/sambadc--chapter.html)
- üì∞ [–í–≤–æ–¥ –≤ –¥–æ–º–µ–Ω](https://docs.altlinux.org/ru-RU/alt-server/11.1/html/alt-server/ch50s07s02.html)

### –ß–∏–Ω–∏–ª–∞ —á–∏–Ω–∏—Ç –≤—Ö–æ–¥ –ø–æ –¥–æ–º–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
–í–æ –≤—Å–µ–º –≤–∏–Ω–æ–≤–∞—Ç sssd.. –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é
–ü–æ—ç—Ç–æ–º—É –Ω–∞—á–Ω–µ–º! –î–ª—è –Ω–∞—á–∞–ª–∞, –Ω–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥ SSSD, –ø–µ—Ä–µ—Ö–æ–¥–∏–º:
```bash
vim /etc/sssd/sssd.conf
–ò —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–µ–µ:
services = nss, pma, ifp # –¥–æ–±–∞–≤–ª—è–µ–º ifp
```
–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º —Å–ª—É–∂–±—É:
```bash
systemctl restart sssd
```
–ù–æ–æ.. –æ–Ω–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ—ç—Ç–æ–º—É, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–¥–µ–ª—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
–ü–µ—Ä–µ—Å–æ–∑–¥–∞–¥–∏–º KeyTab, –¥–ª—è —ç—Ç–æ–≥–æ, –ø–æ–¥ —Ä—É—Ç–æ–º –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º:
```bash
kdestroy -A
```
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```bash
klist -kt /etc/krb5.keytab # –¥–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫ —Å –∏–º–µ–Ω–µ–º –í–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
```
–£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø—Ä–∏–≤—è–∑–∫–∏:
```bash
realm leave
```
–î–ª—è system-auth, —Ç–∞–∫–∂–µ –¥–µ–ª–∞–µ–º:
```bash
control systemctl auth local

system-auth write ad horns.hooves cli horns 'administrator' '–≤–∞—à_–ø–∞—Ä–æ–ª—å'
```
–ó–∞—Ç–µ–º —á–∏—Å—Ç–∏–º –∫—ç—à KeyTab –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—É:
```bash
sss_cache -E
systemctl restart sssd
```
–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –í—Ö–æ–¥ –ø–æ–¥ –¥–æ–º–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

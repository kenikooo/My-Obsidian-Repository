Задание находится в следующем документе: [[Профессионалы Облачные технологии 2026]]
1. Для начала, переходим в оснастку Proxmox, в ней нам требуется развернуть несколько Виртуальных Машин (далее ВМ), на базе образа **alt-p11-cloud- x86_64.qcow2**, для этого, Правой Кнопкой Мыши (далее ПКМ), по образу и клонируем его:
![[Pasted image 20260128012108.png]]
Рис. 1. Клонирование образа для развертывания ВМ

После нажатия на "Clone" вылезет следующее окно:
![[Pasted image 20260128012355.png]]
В нем, от Вас требуется указать Mode - Full Clone и назначить имя Вашей ВМ, после чего жмете Clone.

После того, как ВМ склонирована и успешно создана, в разделе "hardware", требуется внести следующие изменения (выделенные красным):
![[Pasted image 20260128012635.png]]
В Memory, мы указываем 8192MB = 8GB, Processors: 1 Sockets, 4 Cores, а для Hard Disk (показано на следующем фото):
![[Pasted image 20260128012835.png]]
В окошко Resize, Вы прописываете размер диска, который Вам требуется, у нас это 60GB.

После чего, переходим во вкладку "Cloud-init", где меняем следующие параметры: user - задаем первончального юзера (root), и пароль для него (toor), далее, IP Config (net0), ставим адрес для нашей ВМ и шлюз, идущий к ней для доступа в Интернет:
![[Pasted image 20260128013000.png]]

### VM-Nexus01
```bash
# Создаем директорию для проекта
mkdir nexus && cd !$
mkdir certs
# Генерируем самоподписанный сертификат для домена nexus.cloud2026.region:
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout nginx-conf/nexus.key -out nginx-conf/nexus.crt \
  -subj "/CN=nexus.cloud2026.region"
# Создаем файл compose.yml:
vim compose.yml
```
Содержимое файла compose.yml:
```bash
version: '3.8'

services:
  db:
    image: postgres:17-alpine
    container_name: nexus-db
    restart: always
    environment:
      - POSTGRES_DB=nexus
      - POSTGRES_USER=nexus
      - POSTGRES_PASSWORD=nexuspassword
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U nexus"]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
      - postgres_data:/var/lib/postgresql/data

  nexus:
    image: sonatype/nexus3:latest
    container_name: nexus-server
    restart: always
    depends_on:
      db:
        condition: service_healthy
    environment:
      - NEXUS_DATABASES_ENABLED=true
      - NEXUS_DATABASE_TYPE=postgresql
      - NEXUS_DATABASE_HOST=db
      - NEXUS_DATABASE_PORT=5432
      - NEXUS_DATABASE_NAME=nexus
      - NEXUS_DATABASE_USERNAME=nexus
      - NEXUS_DATABASE_PASSWORD=nexuspassword
    ports:
      - "8081:8081"
    volumes:
      - nexus-data:/nexus-data

  proxy:
    image: nginx:alpine
    container_name: nexus-proxy
    restart: always
    ports:
      - "443:443"
    depends_on:
      - nexus
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./certs:/etc/nginx/certs:ro

volumes:
  nexus-data:
  postgres_data:
```
Затем, создаем файл nginx.conf:
```bash
vim nginx.conf
# Содержимое
server {
        listen 443 ssl;
        server_name nexus.cloud2026.region;

        ssl_certificate /etc/nginx/certs/nexus.crt;
        ssl_certificate_key /etc/nginx/certs/nexus.key;

        location / {
                proxy_pass http://nexus:8081;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
                client_max_body_size 0;
        }
}
```
Для запуска используется:
```bash
docker compose up -d
```
Для отключения:
```bash
docker compose down
```

### VM-Dev01
Установим утилиту для распаковки:
```bash
apt-get update && apt-get install unzip -y
```
Создадим директорию:
```bash
mkdir django && cd !$
```
Для начала, установим все файлы требуемые для django (https://disk.yandex.ru/d/OCdg2_2Q52VYaQ), после чего, передадим их на нашу ВМ:
```bash
scp /home/user/Загрузки/django-girls-wo-docker.zip user@10.0.0.11:/tmp
# Адрес 10.0.0.11 - моей ВМ, на которой я собираюсь настроить django
```
После того, как все файлы переданы, на ВМ выполняем следующие команды:
```bash
mv /tmp/django-girls-wo-docker.zip /root/django
unzip django-girls-wo-docker.zip
```
Создадим и опишем Dockerfile:
```bash
vim Dockerfile
# Содержимое:
FROM python:3.9-alpine
RUN apk add --no-cache gcc musl-dev python3-dev postgresql-dev
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
EXPOSE 8000
CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]
```
Следующим шагом, создадим образ:
```bash
docker build -t django-girls-app:1.0 .
```
После создан, увидеть образ Вы сможете командой:
```bash
docker images
```
Для запуска контейнера:
```bash
docker run -d --name django-girls --restart unless-stopped -p 8000:8000 django-girls-app:1.0
```
Взаимодействие с контейнером/образом:
```bash
docker stop django-app # Остановка конейтнера
docker start django-app # Запуск контейнера
docker rm -f django-app # Удаление контейнера
docker logs django-app # Проверка логов контейнера
docker rmi django-girls-app:1.0 # Удаление образа
```
Для проверки работоспособности:
```bash
curl http://localhost:8000
# Или в браузере
http://vm-dev01.cloud2026.region:8000
```

Задание связанное с Nexus:
```bash
# После сборки образа
docker tag django-girls-app:1.0 vm-dev01.cloud2026.region:8082/django-girls-app:1.0
docker push vm-dev01.cloud2026.region:8082/django-girls-app:1.0

# Потом на другой машине или после удаления
docker pull vm-dev01.cloud2026.region:8082/django-girls-app:1.0
docker run -d --name django-app -p 8000:8000 vm-dev01.cloud2026.region:8082/django-girls-app:1.0
```
### VM-GitLab
Создание директории:
```bash
mkdir dockergit && cd !$
mkdir ssl
```
Создаем файл compose.yml и заполняем его:
```bash
vim compose.yml
# Содержимое:
version: '3.8'

services:
  gitlab:
    image: 'gitlab/gitlab-ce:latest'
    restart: always
    hostname: 'gitlab.cloud2026.region'
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'https://gitlab.cloud2026.region'
        nginx['ssl_certificate'] = "/etc/gitlab/ssl/gitlab.cloud2026.region.crt"
        nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/gitlab.cloud2026.region.key"
        letsencrypt['enable'] = false
    ports:
      - '80:80'
      - '443:443'
      - '2222:22'
    volumes:
      - '/srv/gitlab/config:/etc/gitlab'
      - '/srv/gitlab/logs:/var/log/gitlab'
      - '/srv/gitlab/data:/var/opt/gitlab'
      - './ssl:/etc/gitlab/ssl'
```
Для запуска используется:
```bash
docker compose up -d
```
Для отключения:
```bash
docker compose down
```
Также, на рабочем компьютере, в /etc/hosts, добавляем запись:
```bash
ip-компьютера(на котором развернут git) ссылка
# Пример:
10.0.0.20 gitlab.cloud2026.region
```
После чего, через браузер, мы можем перейти в GitLab.

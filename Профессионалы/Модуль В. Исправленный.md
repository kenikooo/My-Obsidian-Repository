Установка HOSTNAME:
```bash
# На srv1
hostnamectl set-hostname srv1-cod.cod.ssa2025; exec bash
# На srv2
hostnamectl set-hostname srv2-cod.cod.ssa2025; exec bash
# На srv3
hostnamectl set-hostname srv3-cod.cod.ssa2025; exec bash
# На srv4
hostnamectl set-hostname srv4-cod.cod.ssa2025; exec bash
```
Дополняем /etc/hosts, на всех узлах:
```bash
192.168.20.11 srv1-cod.cod.ssa2025 srv1-cod
192.168.20.12 srv2-cod.cod.ssa2025 srv2-cod
192.168.20.13 srv3-cod.cod.ssa2025 srv3-cod
192.168.20.14 srv4-cod.cod.ssa2025 srv4-cod
```
### Подготовка дисков и файловых систем
Создание файловых систем XFS (на всех узлах):
```bash
for dev in sdb sdc sdd; do
  mkfs.xfs -f -i size=512 -n size=8192 /dev/$dev
done
```
Создаем папки и настраиваем автоматическое монтирование в /etc/fstab:
```bash
> vim script.sh
Содержимое:
#!/bin/bash
NODE_ID=1
DRIVES=(sdb sdc sdd)

for i in ${!DRIVES[@]}; do
    DEV="/dev/${DRIVES[$i]}"
    MNT="/mnt/minio-data-node${NODE_ID}-$((i+1))"
    
    mkdir -p "$MNT"
    mkfs.xfs -f "$DEV"
    UUID=$(blkid -s UUID -o value "$DEV")
    
    if [ -n "$UUID" ]; then
        echo "UUID=$UUID $MNT xfs defaults,noatime 0 2" >> /etc/fstab
    fi
done
```
Монтируем и проверяем:
```bash
mount -a
df -h | grep minio
chown -R _minio:_minio /mnt/minio-data-node*
chmod -R 755 /mnt/minio-data-node*
```
### Установка MiniO (на всех узлах)
```bash
apt-get update && apt-get install minio minio-mc -y
```
Вносим изменения /etc/sysconfig/minio:
```bash
MINIO_VOLUMES="http://srv1-cod.cod.ssa2025/mnt/minio-data-node1-1 http://srv1-cod.cod.ssa2025/mnt/minio-data-node1-2 http://srv1-cod.cod.ssa2025/mnt/minio-data-node1-3 http://srv2-cod.cod.ssa2025/mnt/minio-data-node2-1 http://srv2-cod.cod.ssa2025/mnt/minio-data-node2-2 http://srv2-cod.cod.ssa2025/mnt/minio-data-node2-3 http://srv3-cod.cod.ssa2025/mnt/minio-data-node3-1 http://srv3-cod.cod.ssa2025/mnt/minio-data-node3-2 http://srv3-cod.cod.ssa2025/mnt/minio-data-node3-3 http://srv4-cod.cod.ssa2025/mnt/minio-data-node4-1 http://srv4-cod.cod.ssa2025/mnt/minio-data-node4-2 http://srv4-cod.cod.ssa2025/mnt/minio-data-node4-3"
MINIO_ADDRESS=":9000" # Неизменна
MINIO_CONSOLE_ADDRESS=":9001" # Убираем 127.0.0.1
MINIO_ROOT_USER=minioadmincluster
MINIO_ROOT_PASSWORD=P@ssw0rd2025
MINIO_SERVER_URL="https://srv1-cod.cod.ssa2025:9000"
MINIO_BROWSER_REDIRECT_URL="https://srv1-cod.cod.ssa2025:9001"
```

#vim
```bash
Замена всех http:// на https://
:%s/http:\/\//https:\/\//g
```
### Настройка TLS/Сертификатов
```bash
vim openssl_san.cnf
Содержимое:
[req]
distinguished_name = req_distinguished_name
x509_extensions = v3_req
prompt = no

[req_distinguished_name]
CN = SSA-CA

[v3_req]
subjectAltName = @alt_names

[alt_names]
DNS.1 = srv1-cod.cod.ssa2025
DNS.2 = srv2-cod.cod.ssa2025
DNS.3 = srv3-cod.cod.ssa2025
DNS.4 = srv4-cod.cod.ssa2025
```

```bash
# Активируем поддержку устаревших алгоритмов на всякий случай
export NODE_OPTIONS=--openssl-legacy-provider

# Создаем ключи CA
openssl genrsa -out ca.key 2048
openssl req -x509 -new -nodes -key ca.key -sha256 -days 3650 -out ca.crt -config openssl_san.cnf
# Генерируем и подписываем все сертификаты в цикле
for i in {1..4}; do
    NODE="srv$i-cod.cod.ssa2025"
    # Обновляем CN в файле конфигурации для текущего узла
    sed -i "s/CN = .*/CN = $NODE/" openssl_san.cnf
    # Генерируем ключ и CSR используя конфигурацию с SAN
    openssl req -new -newkey rsa:2048 -nodes -keyout $NODE.key -out $NODE.csr -config openssl_san.cnf
    # Подписываем CSR
    openssl x509 -req -in $NODE.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out $NODE.crt -days 365 -extensions v3_req -extfile openssl_san.cnf
    # Архивируем для переноса
    tar -cvf $NODE.tar $NODE.crt $NODE.key ca.crt
done
```

```bash
# Массив IP-адресов серверов srv1, srv2, srv3, srv4
IPS=("192.168.20.21" "192.168.20.22" "192.168.20.23" "192.168.20.24")

for i in {0..3}; do
    NODE="srv$((i+1))-cod.cod.ssa2025"
    # Копируем архив в домашнюю папку целевого сервера
    scp $NODE.tar user@${IPS[$i]}:/tmp
done
```
Затем на сервере (в примере srv2):
```bash
cd /etc/minio/certs
mv /tmp/srv2-cod.cod.ssa2025.tar .
# Распаковываем
tar -xvf srv2-cod.cod.ssa2025.tar

mkdir -p CAs
mv ca.crt CAs/
mv srv2-cod.cod.ssa2025.crt public.crt
mv srv2-cod.cod.ssa2025.key private.key
chown -R _minio:_minio /etc/minio/certs
chmod 755 CAs
chmod 644 public.crt
chmod 600 private.key
```